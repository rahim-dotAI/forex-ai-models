name: Forex AI Notebook Runner

# Trigger workflow manually or on schedule (daily UTC times for Forex zones)
on:
  workflow_dispatch:
  schedule:
    - cron: "0 8 * * *"    # London Open 08:00 UTC
    - cron: "30 13 * * *"  # New York Open 13:30 UTC
    - cron: "30 13 * * *"  # London/NY overlap start at 13:30 UTC

jobs:
  run-forex-notebook:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
    # -------------------------------
    # 1️⃣ Checkout repo
    # -------------------------------
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # ensures full repo history for LFS
        lfs: true       # fetch LFS files like CSV, PKL

    # -------------------------------
    # 2️⃣ Install Python & dependencies
    # -------------------------------
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.11

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install \
          papermill \
          ipykernel \
          pandas numpy matplotlib seaborn plotly \
          ta yfinance pyppeteer nest_asyncio \
          lightgbm scikit-learn joblib tqdm mplfinance firebase-admin dropbox beautifulsoup4 alpha_vantage

    # -------------------------------
    # 3️⃣ Register python3 kernel
    # -------------------------------
    - name: Set up Jupyter kernel
      run: |
        python -m ipykernel install --name python3 --display-name "Python 3"

    # -------------------------------
    # 4️⃣ Prepare output folder
    # -------------------------------
    - name: Prepare output folder
      run: mkdir -p output

    # -------------------------------
    # 5️⃣ Run notebook via Papermill
    # -------------------------------
    - name: Execute Forex Notebook
      run: |
        python -c "import nest_asyncio; nest_asyncio.apply()"
        papermill "AI_Forex_Brain 2.ipynb" "output/AI_Forex_Brain_Executed.ipynb" -k python3

    # -------------------------------
    # 6️⃣ Upload output notebook as artifact
    # -------------------------------
    - name: Upload output notebook
      uses: actions/upload-artifact@v4
      with:
        name: AI_Forex_Brain_Executed
        path: output/AI_Forex_Brain_Executed.ipynb
