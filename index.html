<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trade Beacon v2.0.4 - Elite Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg-primary: #0a0e1a;
      --bg-secondary: #111827;
      --bg-tertiary: #1f2937;
      --border: #374151;
      --text-primary: #f9fafb;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;
      --accent-blue: #3b82f6;
      --accent-purple: #a855f7;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #06b6d4;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Navigation */
    .nav { position: sticky; top: 0; z-index: 1000; background: rgba(17, 24, 39, 0.95); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); padding: 16px 32px; }
    .nav-container { max-width: 1800px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; gap: 24px; }
    .logo { display: flex; align-items: center; gap: 12px; font-size: 24px; font-weight: 900; }
    .logo-icon { width: 40px; height: 40px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
    .nav-controls { display: flex; gap: 16px; align-items: center; }
    .status-badge { padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 700; display: flex; align-items: center; gap: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
    .status-live { background: rgba(16, 185, 129, 0.15); color: var(--success); border: 2px solid var(--success); }
    .status-stale { background: rgba(245, 158, 11, 0.15); color: var(--warning); border: 2px solid var(--warning); }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.3; transform: scale(1.3); } }

    .container { max-width: 1800px; margin: 0 auto; padding: 24px 32px; }
    .market-overview { background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(168, 85, 247, 0.1)); border: 1px solid var(--border); border-radius: 24px; padding: 32px; margin-bottom: 32px; }
    .overview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; margin-top: 24px; }
    .overview-item h3 { font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; font-weight: 600; }
    .overview-item p { font-size: 28px; font-weight: 900; letter-spacing: -0.5px; }

    /* Mode Selector */
    .mode-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 32px; }
    .mode-card { background: var(--bg-tertiary); border: 2px solid var(--border); border-radius: 20px; padding: 24px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
    .mode-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)); transform: scaleX(0); transition: transform 0.3s; }
    .mode-card:hover { border-color: var(--accent-blue); transform: translateY(-2px); }
    .mode-card.active { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(168, 85, 247, 0.2)); border-color: var(--accent-blue); box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3); }
    .mode-card.active::before { transform: scaleX(1); }
    .mode-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .mode-title { font-size: 20px; font-weight: 800; }
    .mode-badge { padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 700; background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }
    .mode-params { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 13px; color: var(--text-secondary); }
    .mode-param { display: flex; justify-content: space-between; }
    .mode-param span:last-child { color: var(--text-primary); font-weight: 600; }

    /* Stats Grid */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 32px; }
    .stat-card { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 20px; padding: 24px; position: relative; overflow: hidden; }
    .stat-card::after { content: ''; position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: radial-gradient(circle, rgba(59, 130, 246, 0.1), transparent); border-radius: 50%; transform: translate(30%, -30%); }
    .stat-label { font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; font-weight: 600; }
    .stat-value { font-size: 36px; font-weight: 900; letter-spacing: -1px; line-height: 1; }
    .stat-change { margin-top: 8px; font-size: 13px; display: flex; align-items: center; gap: 4px; }
    .stat-change.positive { color: var(--success); }
    .stat-change.negative { color: var(--danger); }

    /* Signals Section */
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .section-title { font-size: 24px; font-weight: 800; display: flex; align-items: center; gap: 12px; }
    .signal-count { background: var(--bg-secondary); color: var(--accent-blue); padding: 4px 12px; border-radius: 12px; font-size: 14px; font-weight: 700; }
    .filters { display: flex; gap: 12px; flex-wrap: wrap; }
    .filter-btn { padding: 8px 16px; border: 1px solid var(--border); border-radius: 12px; background: var(--bg-secondary); color: var(--text-primary); cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s; }
    .filter-btn:hover { border-color: var(--accent-blue); background: var(--bg-tertiary); }
    .filter-btn.active { background: var(--accent-blue); border-color: var(--accent-blue); color: white; }

    /* Signals Grid */
    .signals-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 20px; margin-bottom: 32px; }
    .signal-card { background: var(--bg-tertiary); border-radius: 20px; padding: 24px; position: relative; transition: all 0.3s; border-left: 4px solid transparent; }
    .signal-card.buy { border-left-color: var(--success); }
    .signal-card.sell { border-left-color: var(--danger); }
    .signal-card:hover { transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3); }
    .signal-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
    .signal-pair { font-size: 24px; font-weight: 900; letter-spacing: -0.5px; }
    .signal-direction { padding: 6px 14px; border-radius: 12px; font-size: 12px; font-weight: 800; letter-spacing: 0.5px; }
    .direction-buy { background: rgba(16, 185, 129, 0.2); color: var(--success); border: 2px solid var(--success); }
    .direction-sell { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 2px solid var(--danger); }

    .signal-meta { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
    .meta-badge { padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 700; background: var(--bg-secondary); color: var(--text-secondary); }

    .confidence-section { margin-bottom: 20px; }
    .confidence-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .confidence-label { font-size: 14px; font-weight: 700; }
    .confidence-score { font-size: 20px; font-weight: 900; }
    .confidence-bar { height: 8px; background: var(--bg-secondary); border-radius: 4px; overflow: hidden; position: relative; }
    .confidence-fill { height: 100%; background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)); transition: width 0.5s ease; border-radius: 4px; }

    .price-grid { background: var(--bg-secondary); border-radius: 16px; padding: 16px; margin-bottom: 16px; }
    .price-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 14px; }
    .price-row:not(:last-child) { border-bottom: 1px solid var(--border); }
    .price-label { color: var(--text-secondary); font-weight: 600; }
    .price-value { font-weight: 800; font-family: 'Courier New', monospace; }
    .signal-footer { display: flex; justify-content: space-between; align-items: center; font-size: 13px; color: var(--text-secondary); }
    .risk-reward { font-weight: 700; color: var(--text-primary); }

    .empty-state { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 24px; padding: 80px 40px; text-align: center; }
    .empty-icon { font-size: 64px; margin-bottom: 24px; opacity: 0.5; }
    .empty-title { font-size: 28px; font-weight: 800; margin-bottom: 12px; }
    .empty-message { font-size: 16px; color: var(--text-secondary); max-width: 500px; margin: 0 auto; }

    .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; gap: 24px; }
    .spinner { width: 60px; height: 60px; border: 4px solid var(--border); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 1200px) { .signals-grid { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); } }
    @media (max-width: 768px) {
      .nav { padding: 12px 20px; }
      .container { padding: 20px; }
      .logo { font-size: 20px; }
      .signals-grid { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: 1fr; }
      .overview-grid { grid-template-columns: 1fr; }
      .section-header { flex-direction: column; align-items: flex-start; gap: 16px; }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="nav-container">
      <div class="logo">
        <div class="logo-icon">üìä</div>
        <div>Trade<span style="background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Beacon</span></div>
      </div>
      <div class="nav-controls">
        <div class="status-badge status-live" id="status">
          <div class="status-dot"></div>
          <span>LOADING</span>
        </div>
      </div>
    </div>
  </nav>

  <div class="container">
    <div id="app">
      <div class="loading">
        <div class="spinner"></div>
        <div style="font-size: 20px; font-weight: 700; color: var(--text-secondary);">Loading Trade Beacon v2.0.4...</div>
      </div>
    </div>
  </div>

  <script>
    let data = null;
    let currentMode = localStorage.getItem('tradeBeaconMode') || 'aggressive';
    let confidenceFilter = 'ALL';
    let directionFilter = 'ALL';

    const API_URLS = [
      './signal_state/dashboard_state.json',
      'signal_state/dashboard_state.json',
      'https://raw.githubusercontent.com/rahim-dotAI/forex-ai-models/main/signal_state/dashboard_state.json'
    ];

    const CONFIG = {
      aggressive: { threshold: 42, min_adx: 15, rsi_oversold: 35, rsi_overbought: 65, min_volume_ratio: 1.0, min_risk_reward: 1.5 },
      conservative: { threshold: 55, min_adx: 22, rsi_oversold: 30, rsi_overbought: 70, min_volume_ratio: 1.2, min_risk_reward: 2.0 }
    };

    function confidenceColor(level) {
      return {
        EXCELLENT: 'var(--success)',
        STRONG: 'var(--accent-blue)',
        GOOD: 'var(--warning)',
        MODERATE: 'var(--text-muted)'
      }[level] || 'var(--text-secondary)';
    }

    async function fetchData() {
      for (const url of API_URLS) {
        try {
          const response = await fetch(url + '?t=' + Date.now(), { cache: 'no-store', headers: { 'Cache-Control': 'no-cache' } });
          if (!response.ok) continue;
          const json = await response.json();
          if (json && json.signals) { data = json; updateStatus('LIVE'); render(); return; }
        } catch (e) { console.warn('Fetch failed:', url, e); }
      }
      updateStatus('STALE'); renderError();
    }

    function updateStatus(status) {
      const statusEl = document.getElementById('status');
      const isLive = status === 'LIVE';
      statusEl.className = `status-badge ${isLive ? 'status-live' : 'status-stale'}`;
      statusEl.innerHTML = `<div class="status-dot"></div><span>${status}</span>`;
    }

    function filterSignalsByMode(signals) {
      const config = CONFIG[currentMode];
      return signals.filter(signal => {
        if (signal.eligible_modes && Array.isArray(signal.eligible_modes)) return signal.eligible_modes.includes(currentMode);
        if (signal.score < config.threshold) return false;
        if (signal.adx != null && signal.adx < config.min_adx) return false;
        if (signal.rsi != null && (signal.rsi < config.rsi_oversold || signal.rsi > config.rsi_overbought)) return false;
        if (signal.risk_reward != null && signal.risk_reward < config.min_risk_reward) return false;
        return true;
      });
    }

    function render() {
      const app = document.getElementById('app');
      if (!data || !data.signals || data.signals.length === 0) {
        app.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üìâ</div>
            <div class="empty-title">No Active Signals</div>
            <div class="empty-message">Trade Beacon v2.0.4 did not generate any active signals at this time.</div>
          </div>`;
        return;
      }

      const signals = filterSignalsByMode(data.signals);

      let html = `
        <div class="mode-selector">
          ${['aggressive','conservative'].map(mode => `
            <div class="mode-card ${currentMode === mode ? 'active' : ''}" onclick="setMode('${mode}')">
              <div class="mode-header">
                <div class="mode-title">${mode.toUpperCase()}</div>
                <div class="mode-badge">TH ${CONFIG[mode].threshold}</div>
              </div>
              <div class="mode-params">
                <div class="mode-param"><span>ADX Min</span><span>${CONFIG[mode].min_adx}</span></div>
                <div class="mode-param"><span>RSI</span><span>${CONFIG[mode].rsi_oversold}-${CONFIG[mode].rsi_overbought}</span></div>
                <div class="mode-param"><span>R:R Min</span><span>${CONFIG[mode].min_risk_reward}</span></div>
              </div>
            </div>`).join('')}
        </div>

        <div class="signals-grid">
          ${signals.map(signal => `
            <div class="signal-card ${signal.direction.toLowerCase()}">
              <div class="signal-header">
                <div class="signal-pair">${signal.pair}</div>
                <div class="signal-direction ${signal.direction.toLowerCase() === 'buy' ? 'direction-buy':'direction-sell'}">${signal.direction}</div>
              </div>
              <div class="signal-meta">
                <div class="meta-badge">ADX: ${signal.adx ?? '-'}</div>
                <div class="meta-badge">RSI: ${signal.rsi ?? '-'}</div>
                <div class="meta-badge">R:R: ${signal.risk_reward ?? '-'}</div>
              </div>
              <div class="confidence-section">
                <div class="confidence-header">
                  <div class="confidence-label">Confidence</div>
                  <div class="confidence-score">${signal.confidence ?? '-'}</div>
                </div>
                <div class="confidence-bar">
                  <div class="confidence-fill" style="width:${signal.score ?? 0}%;background:${confidenceColor(signal.confidence)};"></div>
                </div>
              </div>
            </div>`).join('')}
        </div>
      `;
      app.innerHTML = html;
    }

    function renderError() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">‚ö†Ô∏è</div>
          <div class="empty-title">Unable to load signals</div>
          <div class="empty-message">Please check your network or backend system.</div>
        </div>`;
    }

    function setMode(mode) {
      currentMode = mode;
      localStorage.setItem('tradeBeaconMode', mode);
      render();
    }

    fetchData();
    setInterval(fetchData, 15000);
  </script>
</body>
</html>
