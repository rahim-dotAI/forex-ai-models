<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade Beacon Elite | Live Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#0a0e1a;--surface:#111827;--surface-light:#1f2937;--surface-hover:#252d3d;
--border:#374151;--border-hover:#4b5563;--text:#f9fafb;--text-dim:#9ca3af;--text-dimmer:#6b7280;
--primary:#3b82f6;--success:#10b981;--danger:#ef4444;--warning:#f59e0b;
--purple:#a855f7;--cyan:#06b6d4;
}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;
background-image:radial-gradient(circle at 20% 50%,rgba(59,130,246,0.03) 0%,transparent 50%),
radial-gradient(circle at 80% 80%,rgba(168,85,247,0.03) 0%,transparent 50%);
}
.navbar{display:flex;justify-content:space-between;align-items:center;padding:20px 40px;
background:rgba(17,24,39,0.8);border-bottom:1px solid var(--border);
backdrop-filter:blur(20px);position:sticky;top:0;z-index:1000;}
.logo{font-size:28px;font-weight:900;display:flex;align-items:center;gap:14px}
.logo-icon{width:44px;height:44px;background:linear-gradient(135deg,var(--primary),var(--purple));
border-radius:14px;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 30px rgba(59,130,246,0.3);}
.logo-text{background:linear-gradient(135deg,var(--primary),var(--purple));
-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.status-pill{padding:10px 20px;border-radius:24px;font-size:13px;font-weight:700;
display:flex;align-items:center;gap:10px;}
.status-live{background:rgba(16,185,129,.15);color:var(--success);border:2px solid var(--success)}
.status-stale{background:rgba(245,158,11,.15);color:var(--warning);border:2px solid var(--warning)}
.pulse{width:10px;height:10px;border-radius:50%;background:currentColor;position:relative}
.pulse::before{content:'';position:absolute;inset:-4px;border-radius:50%;border:2px solid currentColor;
animation:pulsate 2s infinite;}
@keyframes pulsate{50%{opacity:0;transform:scale(1.5)}}
.container{max-width:1600px;margin:auto;padding:40px}
.modes{display:flex;gap:12px;margin-bottom:32px}
.mode-btn{padding:16px 24px;border:2px solid var(--border);border-radius:16px;
background:var(--surface-light);color:var(--text);cursor:pointer;
transition:all 0.3s;font-size:14px;font-weight:600;flex:1;text-align:center;}
.mode-btn:hover{border-color:var(--primary);transform:translateY(-2px)}
.mode-btn.active{background:linear-gradient(135deg,var(--primary),var(--purple));
border-color:transparent;box-shadow:0 10px 40px rgba(59,130,246,0.4);}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:32px;}
.stat{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:24px;transition:all 0.3s;}
.stat:hover{transform:translateY(-4px);border-color:var(--border-hover);box-shadow:0 15px 40px rgba(0,0,0,0.3)}
.stat-label{font-size:12px;color:var(--text-dim);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:8px}
.stat-value{font-size:32px;font-weight:900;letter-spacing:-1px}
#signals{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px}
.signal{background:var(--surface-light);border-radius:16px;padding:20px;border-left:4px solid;transition:all 0.3s;}
.signal:hover{transform:translateX(8px);box-shadow:0 12px 30px rgba(0,0,0,0.3)}
.signal.buy{border-color:var(--success)}
.signal.sell{border-color:var(--danger)}
.signal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.signal-pair{font-size:20px;font-weight:800;display:flex;align-items:center;gap:8px}
.signal-direction{padding:4px 10px;border-radius:10px;font-size:11px;font-weight:700;text-transform:uppercase;}
.signal-direction.buy{background:rgba(16,185,129,.2);color:var(--success);border:2px solid var(--success)}
.signal-direction.sell{background:rgba(239,68,68,.2);color:var(--danger);border:2px solid var(--danger)}
.signal-meta{font-size:12px;color:var(--text-dim);margin-bottom:12px}
.signal-metrics{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.signal-metric{padding:10px;background:var(--surface);border-radius:10px;border:1px solid var(--border);}
.signal-metric-label{font-size:10px;color:var(--text-dimmer);text-transform:uppercase;margin-bottom:2px}
.signal-metric-value{font-size:14px;font-weight:700}
.empty{opacity:0.6;text-align:center;padding:60px 20px;color:var(--text-dim)}
@media(max-width:768px){.navbar{padding:16px 20px}.container{padding:24px 20px}.modes{flex-direction:column}.stats{grid-template-columns:1fr}#signals{grid-template-columns:1fr}}
</style>
</head>
<body>

<nav class="navbar">
<div class="logo">
<div class="logo-icon">
<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
<path d="M12 2L2 7L12 12L22 7L12 2Z"/>
<path d="M2 17L12 22L22 17" stroke="white" stroke-width="2" fill="none"/>
<path d="M2 12L12 17L22 12" stroke="white" stroke-width="2" fill="none"/>
</svg>
</div>
<div>Trade<span class="logo-text">Beacon</span></div>
</div>
<div class="status-pill status-live" id="health">
<span class="pulse"></span>
<span id="healthText">LIVE</span>
</div>
</nav>

<div class="container">

<div class="modes">
<button class="mode-btn" id="mode-conservative" onclick="setMode('conservative')">
Conservative<br><small style="opacity:0.7;font-size:11px">High Quality</small>
</button>
<button class="mode-btn" id="mode-balanced" onclick="setMode('balanced')">
Balanced<br><small style="opacity:0.7;font-size:11px">Optimal Mix</small>
</button>
<button class="mode-btn" id="mode-aggressive" onclick="setMode('aggressive')">
Aggressive<br><small style="opacity:0.7;font-size:11px">Max Opportunities</small>
</button>
</div>

<section class="stats">
<div class="stat">
<div class="stat-label">Active Signals</div>
<div class="stat-value" style="color:var(--primary)" id="activeSignals">0</div>
</div>
<div class="stat">
<div class="stat-label">Win Rate</div>
<div class="stat-value" style="color:var(--success)" id="winRate">0%</div>
</div>
<div class="stat">
<div class="stat-label">Total Pips</div>
<div class="stat-value" style="color:var(--warning)" id="totalPips">0</div>
</div>
<div class="stat">
<div class="stat-label">Daily Pips</div>
<div class="stat-value" style="color:var(--cyan)" id="dailyPips">0</div>
</div>
</section>

<section id="signals"></section>

</div>

<script>
/* ================= CONFIG ================= */
const API_URLS = [
  './signal_state/dashboard_state.json',
  'signal_state/dashboard_state.json',
  'https://raw.githubusercontent.com/rahim-dotAI/forex-ai-models/main/signal_state/dashboard_state.json'
];

const MODES = {
  conservative: {threshold:75,minADX:25,minVolumeRatio:1.1,rsiOversold:40,rsiOverbought:60},
  balanced: {threshold:65,minADX:20,minVolumeRatio:1.0,rsiOversold:35,rsiOverbought:65},
  aggressive: {threshold:55,minADX:null,minVolumeRatio:0.9,rsiOversold:30,rsiOverbought:70}
};

let currentMode = localStorage.getItem('mode') || 'balanced';
let timer = null;
let refreshInterval = 15000;
let lastSuccess = null;

/* ================= UTILITY ================= */
function passesMode(signal, mode){
  if(!signal) return false;
  if(signal.score < mode.threshold) return false;
  if(mode.minADX!==null && signal.adx<mode.minADX) return false;
  if(signal.volume_ratio < mode.minVolumeRatio) return false;
  if(signal.rsi < mode.rsiOversold || signal.rsi>mode.rsiOverbought) return false;
  return true;
}

function setMode(mode){
  currentMode = mode;
  localStorage.setItem('mode',mode);
  document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(`mode-${mode}`).classList.add('active');
  update();
}

function validateState(d){
  if(!d || typeof d!=='object') return false;
  if(!Array.isArray(d.signals)) return false;
  if(!d.stats) return false;
  return true;
}

function setHealth(state){
  const el=document.getElementById('health');
  const txt=document.getElementById('healthText');
  el.className='status-pill status-'+state;
  txt.textContent=state.toUpperCase();
}

function getSignalAge(timestamp){
  if(!timestamp) return null;
  try{
    const signalTime=new Date(timestamp.replace('+00:00','Z'));
    const now=new Date();
    return (now-signalTime)/(1000*60*60);
  }catch{return null;}
}

/* ================= FETCH ================= */
async function fetchState(){
  const timestamp=Date.now();
  for(const url of API_URLS){
    try{
      const r=await fetch(url+'?t='+timestamp,{cache:'no-store',headers:{'Cache-Control':'no-cache'}});
      if(!r.ok) continue;
      const data=await r.json();
      if(!validateState(data)) continue;
      return data;
    }catch(e){console.warn('URL failed:',url);}
  }
  throw new Error('All sources failed');
}

/* ================= RENDER ================= */
function renderSignals(allSignals){
  const config=MODES[currentMode];
  const signals=allSignals.filter(s=>passesMode(s,config));
  document.getElementById('activeSignals').textContent=signals.length;
  if(signals.length===0){
    const total=allSignals.length;
    const msg=total>0?`${total} signals filtered by current mode`:'No signals available';
    document.getElementById('signals').innerHTML=`<div class="empty">${msg}</div>`;
    return;
  }

  const html=signals.map(s=>{
    const dir=s.direction.toLowerCase();
    const ageHours=getSignalAge(s.timestamp);
    const ageWarning=ageHours && ageHours>4?`<div style="color:var(--warning);font-size:11px;margin-top:8px">⚠️ ${ageHours.toFixed(1)}h old</div>`:'';
    return `
    <div class="signal ${dir}">
      <div class="signal-header">
        <div class="signal-pair">${s.pair}<span class="signal-direction ${dir}">${s.direction}</span></div>
        ${s.session?`<span style="font-size:11px;color:var(--purple);font-weight:700">${s.session}</span>`:''}
      </div>
      <div class="signal-meta">Score: ${s.score} | ${s.confidence||'MODERATE'} | ${s.sentiment?.overall?`Sentiment: ${s.sentiment.overall.toUpperCase()}`:''}</div>
      <div class="signal-metrics">
        <div class="signal-metric"><div class="signal-metric-label">Entry</div><div class="signal-metric-value">${s.entry_price?.toFixed(5)||'N/A'}</div></div>
        <div class="signal-metric"><div class="signal-metric-label">SL</div><div class="signal-metric-value" style="color:var(--danger)">${s.sl?.toFixed(5)||'N/A'}</div></div>
        <div class="signal-metric"><div class="signal-metric-label">TP</div><div class="signal-metric-value" style="color:var(--success)">${s.tp?.toFixed(5)||'N/A'}</div></div>
        <div class="signal-metric"><div class="signal-metric-label">R:R</div><div class="signal-metric-value" style="color:var(--cyan)">${s.risk_reward||'N/A'}</div></div>
        ${s.rsi?`<div class="signal-metric"><div class="signal-metric-label">RSI</div><div class="signal-metric-value">${s.rsi.toFixed(1)}</div></div>`:''}
        ${s.adx?`<div class="signal-metric"><div class="signal-metric-label">ADX</div><div class="signal-metric-value">${s.adx.toFixed(1)}</div></div>`:''}
        ${s.volume_ratio?`<div class="signal-metric"><div class="signal-metric-label">Volume</div><div class="signal-metric-value" style="color:var(--cyan)">${s.volume_ratio.toFixed(2)}x</div></div>`:''}
        ${s.atr?`<div class="signal-metric"><div class="signal-metric-label">ATR</div><div class="signal-metric-value">${s.atr.toFixed(5)}</div></div>`:''}
      </div>
      ${ageWarning}
    </div>
    `;
  }).join('');
  document.getElementById('signals').innerHTML=html;
}

function render(d){
  document.getElementById('winRate').textContent=(d.stats?.win_rate||0).toFixed(1)+'%';
  document.getElementById('totalPips').textContent=(d.stats?.total_pips||0).toFixed(1);
  document.getElementById('dailyPips').textContent=(d.risk_management?.daily_pips||0).toFixed(1);
  renderSignals(d.signals||[]);
}

/* ================= UPDATE LOOP ================= */
function adjustInterval(success){
  if(success) refreshInterval=15000;
  else refreshInterval=Math.min(refreshInterval*2,120000);
  if(timer) clearInterval(timer);
  timer=setInterval(update,refreshInterval);
}

async function update(){
  try{
    const data=await fetchState();
    render(data);
    setHealth('live');
    lastSuccess=Date.now();
    adjustInterval(true);
  }catch(e){
    console.error('Update failed:',e);
    adjustInterval(false);
    if(lastSuccess && Date.now()-lastSuccess<300000) setHealth('stale');
  }
}

/* ================= INIT ================= */
setMode(currentMode);
update();
timer=setInterval(update,refreshInterval);
</script>

</body>
</html>
