<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trade Beacon v2.1.2 - Professional Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-primary: #0a0e1a;
      --bg-secondary: #111827;
      --bg-tertiary: #1f2937;
      --bg-card: #1a1f2e;
      --border: #374151;
      --border-light: #4b5563;
      --text-primary: #f9fafb;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;
      --accent-blue: #3b82f6;
      --accent-purple: #a855f7;
      --accent-cyan: #06b6d4;
      --success: #10b981;
      --success-dark: #059669;
      --danger: #ef4444;
      --danger-dark: #dc2626;
      --warning: #f59e0b;
      --info: #06b6d4;
      --glow-blue: rgba(59, 130, 246, 0.3);
      --glow-purple: rgba(168, 85, 247, 0.3);
      --glow-green: rgba(16, 185, 129, 0.3);
      --glow-red: rgba(239, 68, 68, 0.3);
      --gold: #fbbf24;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    .nav {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: rgba(17, 24, 39, 0.98);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      padding: 16px 32px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
    }

    .nav-container {
      max-width: 1920px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 24px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 900;
    }

    .logo-icon {
      width: 42px;
      height: 42px;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 4px 20px var(--glow-blue);
    }

    .nav-controls {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .status-badge {
      padding: 10px 20px;
      border-radius: 24px;
      font-size: 12px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
    }

    .status-loading {
      background: rgba(59, 130, 246, 0.15);
      color: var(--accent-blue);
      border: 2px solid var(--accent-blue);
    }

    .status-live {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
      border: 2px solid var(--success);
      box-shadow: 0 0 20px var(--glow-green);
    }

    .status-paused {
      background: rgba(245, 158, 11, 0.15);
      color: var(--warning);
      border: 2px solid var(--warning);
    }

    .status-stale {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
      border: 2px solid var(--danger);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.3; transform: scale(1.5); }
    }

    .container {
      max-width: 1920px;
      margin: 0 auto;
      padding: 32px;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 32px;
      background: var(--bg-card);
      padding: 8px;
      border-radius: 16px;
      border: 1px solid var(--border);
    }

    .tab {
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      color: var(--text-secondary);
      border: 2px solid transparent;
    }

    .tab:hover {
      color: var(--text-primary);
      background: rgba(59, 130, 246, 0.1);
    }

    .tab.active {
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      color: var(--text-primary);
      box-shadow: 0 4px 20px var(--glow-blue);
    }

    .hero-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .hero-card {
      background: linear-gradient(135deg, var(--bg-card), var(--bg-tertiary));
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 28px;
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .hero-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
      opacity: 0;
      transition: opacity 0.3s;
    }

    .hero-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      border-color: var(--border-light);
    }

    .hero-card:hover::before {
      opacity: 1;
    }

    .hero-label {
      font-size: 13px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .hero-value {
      font-size: 42px;
      font-weight: 900;
      letter-spacing: -1.5px;
      line-height: 1;
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--text-primary), var(--accent-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .hero-subtitle {
      font-size: 14px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .change-positive {
      color: var(--success);
      font-weight: 700;
    }

    .change-negative {
      color: var(--danger);
      font-weight: 700;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
    }

    .section-title {
      font-size: 28px;
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 12px;
      letter-spacing: -0.5px;
    }

    .trades-grid {
      display: grid;
      gap: 16px;
      margin-bottom: 40px;
    }

    .trade-row {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px 24px;
      display: grid;
      grid-template-columns: 120px 100px 120px 120px 120px 120px 1fr 100px;
      gap: 20px;
      align-items: center;
      transition: all 0.3s;
      border-left: 4px solid transparent;
    }

    .trade-row.win {
      border-left-color: var(--success);
    }

    .trade-row.loss {
      border-left-color: var(--danger);
    }

    .trade-row.expired {
      border-left-color: var(--warning);
      opacity: 0.7;
    }

    .trade-row:hover {
      transform: translateX(4px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border-color: var(--border-light);
    }

    .trade-cell {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .trade-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    .trade-value {
      font-size: 15px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .trade-pair {
      font-size: 18px;
      font-weight: 900;
      letter-spacing: -0.5px;
    }

    .trade-direction {
      padding: 4px 12px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 800;
      width: fit-content;
    }

    .direction-buy {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      border: 1px solid var(--success);
    }

    .direction-sell {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
      border: 1px solid var(--danger);
    }

    .pips-badge {
      padding: 6px 14px;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 900;
      font-family: 'Courier New', monospace;
    }

    .pips-win {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      border: 2px solid var(--success);
    }

    .pips-loss {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
      border: 2px solid var(--danger);
    }

    .pips-expired {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
      border: 2px solid var(--warning);
    }

    .highlight-card {
      background: linear-gradient(135deg, var(--bg-card), var(--bg-tertiary));
      border: 2px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      position: relative;
      overflow: hidden;
    }

    .highlight-card::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      border-radius: 20px;
      z-index: -1;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .highlight-card:hover::before {
      opacity: 0.3;
    }

    .highlight-card.best {
      border-color: var(--success);
      box-shadow: 0 8px 32px var(--glow-green);
    }

    .highlight-card.worst {
      border-color: var(--danger);
      box-shadow: 0 8px 32px var(--glow-red);
    }

    .highlight-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .highlight-title {
      font-size: 16px;
      font-weight: 800;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .highlight-badge {
      padding: 6px 16px;
      border-radius: 12px;
      font-size: 24px;
      font-weight: 900;
      font-family: 'Courier New', monospace;
    }

    .highlight-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 16px;
    }

    .highlight-stat {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .highlight-stat-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .highlight-stat-value {
      font-size: 16px;
      font-weight: 900;
    }

    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }

    .analytics-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
    }

    .analytics-title {
      font-size: 16px;
      font-weight: 800;
      margin-bottom: 20px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .analytics-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .analytics-row:last-child {
      border-bottom: none;
    }

    .analytics-label {
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .analytics-value {
      font-size: 16px;
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .analytics-bar {
      height: 6px;
      background: var(--bg-secondary);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 8px;
    }

    .analytics-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
      border-radius: 3px;
      transition: width 0.6s ease;
    }

    .signals-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }

    .signal-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 28px;
      position: relative;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-left: 4px solid transparent;
    }

    .signal-card.buy {
      border-left-color: var(--success);
    }

    .signal-card.sell {
      border-left-color: var(--danger);
    }

    .signal-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);
      border-color: var(--border-light);
    }

    .signal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 24px;
    }

    .signal-pair {
      font-size: 28px;
      font-weight: 900;
      letter-spacing: -1px;
    }

    .signal-direction {
      padding: 8px 18px;
      border-radius: 14px;
      font-size: 13px;
      font-weight: 800;
      letter-spacing: 0.5px;
    }

    .signal-meta {
      display: flex;
      gap: 10px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .meta-badge {
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 700;
      background: var(--bg-secondary);
      color: var(--text-secondary);
      border: 1px solid var(--border);
    }

    .confidence-section {
      margin-bottom: 24px;
    }

    .confidence-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .confidence-label {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .confidence-score {
      font-size: 24px;
      font-weight: 900;
      letter-spacing: -0.5px;
    }

    .confidence-bar {
      height: 10px;
      background: var(--bg-secondary);
      border-radius: 6px;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .confidence-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
      transition: width 0.6s ease;
      border-radius: 6px;
      box-shadow: 0 0 12px currentColor;
    }

    .price-grid {
      background: var(--bg-secondary);
      border-radius: 18px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border);
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      font-size: 14px;
    }

    .price-row:not(:last-child) {
      border-bottom: 1px solid var(--border);
    }

    .price-label {
      color: var(--text-secondary);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .price-value {
      font-weight: 900;
      font-family: 'Courier New', monospace;
      font-size: 15px;
    }

    .price-value.entry {
      color: var(--accent-cyan);
    }

    .price-value.tp {
      color: var(--success);
    }

    .price-value.sl {
      color: var(--danger);
    }

    .signal-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .risk-reward {
      font-weight: 900;
      font-size: 16px;
      color: var(--text-primary);
    }

    .signal-time {
      font-size: 12px;
      color: var(--text-muted);
    }

    .empty-state {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 80px 40px;
      text-align: center;
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 24px;
      opacity: 0.5;
    }

    .empty-title {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 12px;
    }

    .empty-message {
      font-size: 16px;
      color: var(--text-secondary);
      max-width: 500px;
      margin: 0 auto;
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
      gap: 24px;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--border);
      border-top-color: var(--accent-blue);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .trophy-icon {
      font-size: 32px;
      filter: drop-shadow(0 0 10px var(--gold));
    }

    @media (max-width: 1400px) {
      .trade-row {
        grid-template-columns: 100px 80px 100px 100px 100px 100px 1fr 80px;
        gap: 12px;
        font-size: 13px;
      }
    }

    @media (max-width: 1024px) {
      .trade-row {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .tabs {
        overflow-x: auto;
        flex-wrap: nowrap;
      }

      .signals-grid,
      .analytics-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .nav {
        padding: 12px 20px;
      }

      .container {
        padding: 20px;
      }

      .logo {
        font-size: 18px;
      }

      .hero-stats {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="nav-container">
      <div class="logo">
        <div class="logo-icon">üìä</div>
        <div>
          Trade<span style="background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Beacon</span>
          <span style="font-size: 11px; color: var(--text-muted); font-weight: 500; margin-left: 8px;">v2.1.2</span>
        </div>
      </div>
      <div class="nav-controls">
        <div style="font-size: 12px; color: var(--text-secondary); margin-right: 12px;" id="lastUpdate">
          Last update: --:--
        </div>
        <div class="status-badge status-loading" id="status">
          <div class="status-dot"></div>
          <span>LOADING</span>
        </div>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="tabs">
      <div class="tab active" onclick="switchTab('overview')">üìä Overview</div>
      <div class="tab" onclick="switchTab('signals')">üì° Active Signals</div>
      <div class="tab" onclick="switchTab('history')">üìú Trade History</div>
      <div class="tab" onclick="switchTab('analytics')">üìà Analytics</div>
    </div>

    <div id="app">
      <div class="loading">
        <div class="spinner"></div>
        <div style="font-size: 20px; font-weight: 700; color: var(--text-secondary);">Loading Trade Beacon v2.1.2...</div>
      </div>
    </div>
  </div>

  <script>
    let data = null;
    let historyData = null;
    let currentMode = localStorage.getItem('tradeBeaconMode') || 'conservative';
    let currentTab = 'overview';
    let refreshInterval = 60000;

    const API_URLS = [
      './signal_state/dashboard_state.json',
      'signal_state/dashboard_state.json',
      'https://raw.githubusercontent.com/rahim-dotAI/forex-ai-models/main/signal_state/dashboard_state.json'
    ];

    const HISTORY_URLS = [
      './signal_state/signal_history.json',
      'signal_state/signal_history.json',
      'https://raw.githubusercontent.com/rahim-dotAI/forex-ai-models/main/signal_state/signal_history.json'
    ];

    async function fetchData() {
      // Fetch dashboard data
      for (const url of API_URLS) {
        try {
          const response = await fetch(url, { cache: 'no-store' });
          if (response.ok) {
            data = await response.json();
            currentMode = data?.mode || currentMode;
            break;
          }
        } catch (error) {
          console.warn(`Failed to fetch from ${url}`);
        }
      }

      // Fetch history data
      for (const url of HISTORY_URLS) {
        try {
          const response = await fetch(url, { cache: 'no-store' });
          if (response.ok) {
            historyData = await response.json();
            break;
          }
        } catch (error) {
          console.warn(`Failed to fetch history from ${url}`);
        }
      }

      updateUI();
    }

    function updateStatus(type, text) {
      const statusEl = document.getElementById('status');
      statusEl.className = `status-badge status-${type}`;
      statusEl.innerHTML = `<div class="status-dot"></div><span>${text}</span>`;
    }

    function getTimeDiff(timestamp) {
      const now = new Date();
      const then = new Date(timestamp);
      const diffMs = now - then;
      const diffMins = Math.floor(diffMs / 60000);
      
      if (diffMins < 1) return 'Just now';
      if (diffMins < 60) return `${diffMins}m ago`;
      const diffHours = Math.floor(diffMins / 60);
      if (diffHours < 24) return `${diffHours}h ago`;
      return `${Math.floor(diffHours / 24)}d ago`;
    }

    function formatTime(timestamp) {
      const date = new Date(timestamp);
      return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    }

    function switchTab(tab) {
      currentTab = tab;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      updateUI();
    }

    function getTodayTrades() {
      if (!historyData || !historyData.signals) return [];
      
      const today = new Date().toISOString().split('T')[0];
      return historyData.signals.filter(s => {
        const tradeDate = s.exit_time || s.timestamp;
        if (!tradeDate) return false;
        return tradeDate.startsWith(today) && ['WIN', 'LOSS', 'EXPIRED'].includes(s.status);
      });
    }

    function getBestWorstTrades() {
      const todayTrades = getTodayTrades();
      if (todayTrades.length === 0) return { best: null, worst: null };

      const resolved = todayTrades.filter(t => t.status === 'WIN' || t.status === 'LOSS');
      if (resolved.length === 0) return { best: null, worst: null };

      const sorted = resolved.sort((a, b) => (b.pips || 0) - (a.pips || 0));
      return {
        best: sorted[0],
        worst: sorted[sorted.length - 1]
      };
    }

    function renderOverview() {
      if (!data) return '<div class="loading"><div class="spinner"></div></div>';

      let signals = data?.signals || [];
      signals = signals.filter(s =>
        Array.isArray(s.eligible_modes) &&
        s.eligible_modes.includes(currentMode)
      );

      const stats = data?.stats || {};
      const session = data?.session || 'UNKNOWN';
      const marketState = data?.market_state || {};
      const todayTrades = getTodayTrades();
      const { best, worst } = getBestWorstTrades();

      // Calculate today's stats
      const todayWins = todayTrades.filter(t => t.status === 'WIN').length;
      const todayLosses = todayTrades.filter(t => t.status === 'LOSS').length;
      const todayPips = todayTrades.reduce((sum, t) => sum + (t.pips || 0), 0);

      let html = `
        <div class="hero-stats">
          <div class="hero-card">
            <div class="hero-label">Active Signals</div>
            <div class="hero-value">${signals.length}</div>
            <div class="hero-subtitle">${currentMode.toUpperCase()} mode</div>
          </div>
          
          <div class="hero-card">
            <div class="hero-label">Today's Performance</div>
            <div class="hero-value ${todayPips >= 0 ? 'change-positive' : 'change-negative'}">
              ${todayPips >= 0 ? '+' : ''}${todayPips.toFixed(1)}
            </div>
            <div class="hero-subtitle">${todayWins}W / ${todayLosses}L today</div>
          </div>
          
          <div class="hero-card">
            <div class="hero-label">Overall Win Rate</div>
            <div class="hero-value">${stats.win_rate?.toFixed(1) || '0.0'}%</div>
            <div class="hero-subtitle">${stats.wins || 0}W / ${stats.losses || 0}L all time</div>
          </div>
          
          <div class="hero-card">
            <div class="hero-label">Total Pips</div>
            <div class="hero-value ${(stats.total_pips || 0) >= 0 ? 'change-positive' : 'change-negative'}">
              ${(stats.total_pips || 0) >= 0 ? '+' : ''}${stats.total_pips?.toFixed(1) || '0.0'}
            </div>
            <div class="hero-subtitle">${stats.total_trades || 0} trades</div>
          </div>
          
          <div class="hero-card">
            <div class="hero-label">Expectancy</div>
            <div class="hero-value ${(stats.expectancy_pips || 0) >= 0 ? 'change-positive' : 'change-negative'}">
              ${(stats.expectancy_pips || 0) >= 0 ? '+' : ''}${stats.expectancy_pips?.toFixed(2) || '0.00'}
            </div>
            <div class="hero-subtitle">pips per trade</div>
          </div>
          
          <div class="hero-card">
            <div class="hero-label">Market Session</div>
            <div class="hero-value" style="font-size: 32px;">${session}</div>
            <div class="hero-subtitle">${marketState.volatility || 'NORMAL'} volatility</div>
          </div>
        </div>
      `;

      // Best/Worst trades of the day
      if (best || worst) {
        html += `
          <div class="section-header">
            <div class="section-title">üèÜ Today's Highlights</div>
          </div>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px; margin-bottom: 40px;">
        `;

        if (best) {
          html += `
            <div class="highlight-card best">
              <div class="highlight-header">
                <div class="highlight-title">
                  <span class="trophy-icon">üèÜ</span>
                  Best Trade
                </div>
                <div class="highlight-badge pips-win">+${best.pips?.toFixed(1) || '0.0'}</div>
              </div>
              <div class="highlight-details">
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Pair</div>
                  <div class="highlight-stat-value">${best.pair || 'N/A'}</div>
                </div>
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Direction</div>
                  <div class="highlight-stat-value">${best.direction || 'N/A'}</div>
                </div>
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Entry</div>
                  <div class="highlight-stat-value">${best.entry_price?.toFixed(5) || 'N/A'}</div>
                </div>
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Exit</div>
                  <div class="highlight-stat-value">${best.exit_price?.toFixed(5) || 'N/A'}</div>
                </div>
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Session</div>
                  <div class="highlight-stat-value">${best.session || 'N/A'}</div>
                </div>
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Time</div>
                  <div class="highlight-stat-value">${formatTime(best.exit_time || best.timestamp)}</div>
                </div>
              </div>
            </div>
          `;
        }

        if (worst && worst.pips < 0) {
          html += `
            <div class="highlight-card worst">
              <div class="highlight-header">
                <div class="highlight-title">
                  üìâ Largest Loss
                </div>
                <div class="highlight-badge pips-loss">${worst.pips?.toFixed(1) || '0.0'}</div>
              </div>
              <div class="highlight-details">
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Pair</div>
                  <div class="highlight-stat-value">${worst.pair || 'N/A'}</div>
                </div>
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Direction</div>
                  <div class="highlight-stat-value">${worst.direction || 'N/A'}</div>
                </div>
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Entry</div>
                  <div class="highlight-stat-value">${worst.entry_price?.toFixed(5) || 'N/A'}</div>
                </div>
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Exit</div>
                  <div class="highlight-stat-value">${worst.exit_price?.toFixed(5) || 'N/A'}</div>
                </div>
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Session</div>
                  <div class="highlight-stat-value">${worst.session || 'N/A'}</div>
                </div>
                <div class="highlight-stat">
                  <div class="highlight-stat-label">Time</div>
                  <div class="highlight-stat-value">${formatTime(worst.exit_time || worst.timestamp)}</div>
                </div>
              </div>
            </div>
          `;
        }

        html += `</div>`;
      }

      // Active signals preview
      if (signals.length > 0) {
        html += `
          <div class="section-header">
            <div class="section-title">üì° Active Signals <span style="background: var(--bg-secondary); color: var(--accent-blue); padding: 6px 16px; border-radius: 14px; font-size: 15px; font-weight: 700; margin-left: 12px;">${signals.length}</span></div>
            <div style="font-size: 14px; color: var(--text-secondary); cursor: pointer;" onclick="switchTab('signals'); document.querySelectorAll('.tab')[1].click();">View all ‚Üí</div>
          </div>
          <div class="signals-grid">
        `;

        signals.slice(0, 3).forEach(signal => {
          const direction = signal.direction?.toLowerCase() || 'buy';
          const confidence = signal.score || signal.technical_score || 0;
          const confidenceWidth = Math.min(100, (confidence / 100) * 100);
          
          html += `
            <div class="signal-card ${direction}">
              <div class="signal-header">
                <div class="signal-pair">${signal.pair || 'N/A'}</div>
                <div class="signal-direction direction-${direction}">${signal.direction || 'BUY'}</div>
              </div>
              
              <div class="signal-meta">
                <div class="meta-badge">üìä ${signal.session || 'UNKNOWN'}</div>
                <div class="meta-badge">‚è± ${signal.hold_time || 'INTRADAY'}</div>
                <div class="meta-badge">üéØ ${signal.confidence || 'MODERATE'}</div>
              </div>
              
              <div class="confidence-section">
                <div class="confidence-header">
                  <div class="confidence-label">Signal Strength</div>
                  <div class="confidence-score">${confidence}</div>
                </div>
                <div class="confidence-bar">
                  <div class="confidence-fill" style="width: ${confidenceWidth}%"></div>
                </div>
              </div>
              
              <div class="price-grid">
                <div class="price-row">
                  <div class="price-label">üìç Entry</div>
                  <div class="price-value entry">${signal.entry_price?.toFixed(5) || 'N/A'}</div>
                </div>
                <div class="price-row">
                  <div class="price-label">üéØ Take Profit</div>
                  <div class="price-value tp">${signal.tp?.toFixed(5) || 'N/A'}</div>
                </div>
                <div class="price-row">
                  <div class="price-label">üõë Stop Loss</div>
                  <div class="price-value sl">${signal.sl?.toFixed(5) || 'N/A'}</div>
                </div>
              </div>
              
              <div class="signal-footer">
                <div class="risk-reward">R:R ${signal.risk_reward?.toFixed(2) || 'N/A'}</div>
                <div class="signal-time">${getTimeDiff(signal.timestamp)}</div>
              </div>
            </div>
          `;
        });

        html += `</div>`;
      }

      return html;
    }

    function renderSignals() {
      if (!data) return '<div class="loading"><div class="spinner"></div></div>';

      let signals = data?.signals || [];
      signals = signals.filter(s =>
        Array.isArray(s.eligible_modes) &&
        s.eligible_modes.includes(currentMode)
      );

      if (signals.length === 0) {
        return `
          <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <div class="empty-title">No Active Signals</div>
            <div class="empty-message">No ${currentMode} signals meet the current criteria. The system is actively monitoring markets.</div>
          </div>
        `;
      }

      let html = `
        <div class="section-header">
          <div class="section-title">üì° Active Signals <span style="background: var(--bg-secondary); color: var(--accent-blue); padding: 6px 16px; border-radius: 14px; font-size: 15px; font-weight: 700; margin-left: 12px;">${signals.length}</span></div>
        </div>
        <div class="signals-grid">
      `;

      signals.forEach(signal => {
        const direction = signal.direction?.toLowerCase() || 'buy';
        const confidence = signal.score || signal.technical_score || 0;
        const confidenceWidth = Math.min(100, (confidence / 100) * 100);
        
        html += `
          <div class="signal-card ${direction}">
            <div class="signal-header">
              <div class="signal-pair">${signal.pair || 'N/A'}</div>
              <div class="signal-direction direction-${direction}">${signal.direction || 'BUY'}</div>
            </div>
            
            <div class="signal-meta">
              <div class="meta-badge">üìä ${signal.session || 'UNKNOWN'}</div>
              <div class="meta-badge">‚è± ${signal.hold_time || 'INTRADAY'}</div>
              <div class="meta-badge">üéØ ${signal.confidence || 'MODERATE'}</div>
              ${signal.metadata?.signal_type ? `<div class="meta-badge">üìà ${signal.metadata.signal_type}</div>` : ''}
            </div>
            
            <div class="confidence-section">
              <div class="confidence-header">
                <div class="confidence-label">Signal Strength</div>
                <div class="confidence-score">${confidence}</div>
              </div>
              <div class="confidence-bar">
                <div class="confidence-fill" style="width: ${confidenceWidth}%"></div>
              </div>
            </div>
            
            <div class="price-grid">
              <div class="price-row">
                <div class="price-label">üìç Entry</div>
                <div class="price-value entry">${signal.entry_price?.toFixed(5) || 'N/A'}</div>
              </div>
              <div class="price-row">
                <div class="price-label">üéØ Take Profit</div>
                <div class="price-value tp">${signal.tp?.toFixed(5) || 'N/A'}</div>
              </div>
              <div class="price-row">
                <div class="price-label">üõë Stop Loss</div>
                <div class="price-value sl">${signal.sl?.toFixed(5) || 'N/A'}</div>
              </div>
            </div>
            
            <div class="signal-footer">
              <div class="risk-reward">R:R ${signal.risk_reward?.toFixed(2) || 'N/A'}</div>
              <div class="signal-time">${getTimeDiff(signal.timestamp)}</div>
            </div>
          </div>
        `;
      });

      html += `</div>`;
      return html;
    }

    function renderHistory() {
      if (!historyData || !historyData.signals) {
        return `
          <div class="empty-state">
            <div class="empty-icon">üìú</div>
            <div class="empty-title">No Trade History</div>
            <div class="empty-message">Trade history will appear here once signals are resolved.</div>
          </div>
        `;
      }

      const allTrades = historyData.signals.filter(s => ['WIN', 'LOSS', 'EXPIRED'].includes(s.status));
      
      if (allTrades.length === 0) {
        return `
          <div class="empty-state">
            <div class="empty-icon">üìú</div>
            <div class="empty-title">No Trade History</div>
            <div class="empty-message">Trade history will appear here once signals are resolved.</div>
          </div>
        `;
      }

      // Sort by most recent
      const sortedTrades = allTrades.sort((a, b) => {
        const aTime = new Date(a.exit_time || a.timestamp);
        const bTime = new Date(b.exit_time || b.timestamp);
        return bTime - aTime;
      });

      let html = `
        <div class="section-header">
          <div class="section-title">üìú Trade History <span style="background: var(--bg-secondary); color: var(--accent-blue); padding: 6px 16px; border-radius: 14px; font-size: 15px; font-weight: 700; margin-left: 12px;">${sortedTrades.length}</span></div>
        </div>
        <div class="trades-grid">
      `;

      sortedTrades.forEach(trade => {
        const statusClass = trade.status.toLowerCase();
        const pipsClass = trade.status === 'WIN' ? 'pips-win' : (trade.status === 'LOSS' ? 'pips-loss' : 'pips-expired');
        const pipsSign = (trade.pips || 0) >= 0 ? '+' : '';

        html += `
          <div class="trade-row ${statusClass}">
            <div class="trade-cell">
              <div class="trade-label">Pair</div>
              <div class="trade-pair">${trade.pair || 'N/A'}</div>
            </div>
            
            <div class="trade-cell">
              <div class="trade-label">Direction</div>
              <div class="trade-direction direction-${trade.direction?.toLowerCase() || 'buy'}">${trade.direction || 'N/A'}</div>
            </div>
            
            <div class="trade-cell">
              <div class="trade-label">Entry</div>
              <div class="trade-value">${trade.entry_price?.toFixed(5) || 'N/A'}</div>
            </div>
            
            <div class="trade-cell">
              <div class="trade-label">Exit</div>
              <div class="trade-value">${trade.exit_price?.toFixed(5) || 'N/A'}</div>
            </div>
            
            <div class="trade-cell">
              <div class="trade-label">Result</div>
              <div class="pips-badge ${pipsClass}">${pipsSign}${trade.pips?.toFixed(1) || '0.0'}</div>
            </div>
            
            <div class="trade-cell">
              <div class="trade-label">Session</div>
              <div class="trade-value">${trade.session || 'N/A'}</div>
            </div>
            
            <div class="trade-cell">
              <div class="trade-label">Confidence</div>
              <div class="trade-value">${trade.confidence || 'N/A'}</div>
            </div>
            
            <div class="trade-cell">
              <div class="trade-label">Time</div>
              <div class="trade-value">${formatTime(trade.exit_time || trade.timestamp)}</div>
            </div>
          </div>
        `;
      });

      html += `</div>`;
      return html;
    }

    function renderAnalytics() {
      if (!historyData || !historyData.analytics) {
        return `
          <div class="empty-state">
            <div class="empty-icon">üìà</div>
            <div class="empty-title">No Analytics Data</div>
            <div class="empty-message">Analytics will appear here once you have sufficient trade history.</div>
          </div>
        `;
      }

      const analytics = historyData.analytics;
      const stats = historyData.stats || {};

      let html = `
        <div class="hero-stats">
          <div class="hero-card">
            <div class="hero-label">Total Trades</div>
            <div class="hero-value">${stats.total_trades || 0}</div>
            <div class="hero-subtitle">All time</div>
          </div>
          
          <div class="hero-card">
            <div class="hero-label">Win Rate</div>
            <div class="hero-value">${stats.win_rate?.toFixed(1) || '0.0'}%</div>
            <div class="hero-subtitle">${stats.wins || 0}W / ${stats.losses || 0}L</div>
          </div>
          
          <div class="hero-card">
            <div class="hero-label">Average Win</div>
            <div class="hero-value change-positive">+${stats.avg_win?.toFixed(1) || '0.0'}</div>
            <div class="hero-subtitle">pips</div>
          </div>
          
          <div class="hero-card">
            <div class="hero-label">Average Loss</div>
            <div class="hero-value change-negative">-${stats.avg_loss?.toFixed(1) || '0.0'}</div>
            <div class="hero-subtitle">pips</div>
          </div>
        </div>

        <div class="analytics-grid">
      `;

      // By Session
      if (analytics.by_session && Object.keys(analytics.by_session).length > 0) {
        html += `
          <div class="analytics-card">
            <div class="analytics-title">üìä Performance by Session</div>
        `;

        Object.entries(analytics.by_session).forEach(([session, data]) => {
          const winRate = data.win_rate || 0;
          html += `
            <div class="analytics-row">
              <div class="analytics-label">${session}</div>
              <div class="analytics-value">
                ${winRate.toFixed(0)}%
                <span style="font-size: 12px; color: var(--text-muted);">(${data.trades} trades)</span>
              </div>
            </div>
            <div class="analytics-bar">
              <div class="analytics-fill" style="width: ${winRate}%"></div>
            </div>
          `;
        });

        html += `</div>`;
      }

      // By Confidence
      if (analytics.by_confidence && Object.keys(analytics.by_confidence).length > 0) {
        html += `
          <div class="analytics-card">
            <div class="analytics-title">üéØ Performance by Confidence</div>
        `;

        Object.entries(analytics.by_confidence).forEach(([conf, data]) => {
          const winRate = data.win_rate || 0;
          html += `
            <div class="analytics-row">
              <div class="analytics-label">${conf}</div>
              <div class="analytics-value">
                ${winRate.toFixed(0)}%
                <span style="font-size: 12px; color: var(--text-muted);">(${data.trades} trades)</span>
              </div>
            </div>
            <div class="analytics-bar">
              <div class="analytics-fill" style="width: ${winRate}%"></div>
            </div>
          `;
        });

        html += `</div>`;
      }

      // By Pair
      if (analytics.by_pair && Object.keys(analytics.by_pair).length > 0) {
        html += `
          <div class="analytics-card">
            <div class="analytics-title">üí± Performance by Pair</div>
        `;

        Object.entries(analytics.by_pair).forEach(([pair, data]) => {
          const winRate = data.win_rate || 0;
          const totalPips = data.total_pips || 0;
          html += `
            <div class="analytics-row">
              <div class="analytics-label">${pair}</div>
              <div class="analytics-value">
                ${winRate.toFixed(0)}%
                <span style="font-size: 12px; ${totalPips >= 0 ? 'color: var(--success)' : 'color: var(--danger)'};">
                  (${totalPips >= 0 ? '+' : ''}${totalPips.toFixed(1)}p)
                </span>
              </div>
            </div>
            <div class="analytics-bar">
              <div class="analytics-fill" style="width: ${winRate}%"></div>
            </div>
          `;
        });

        html += `</div>`;
      }

      html += `</div>`;
      return html;
    }

    function updateUI() {
      if (!data && !historyData) return;

      // Update status
      const canTrade = data?.equity_protection?.can_trade !== false;
      const isPaused = data?.equity_protection?.pause_reason;

      if (isPaused) {
        updateStatus('paused', 'PAUSED');
      } else if (canTrade) {
        updateStatus('live', 'LIVE');
      } else {
        updateStatus('loading', 'UPDATING');
      }

      // Update last update time
      const lastUpdate = data?.timestamp || data?.system?.last_update;
      if (lastUpdate) {
        const date = new Date(lastUpdate);
        document.getElementById('lastUpdate').textContent = `Last update: ${date.toLocaleTimeString()}`;
      }

      // Render current tab
      let html = '';
      switch (currentTab) {
        case 'overview':
          html = renderOverview();
          break;
        case 'signals':
          html = renderSignals();
          break;
        case 'history':
          html = renderHistory();
          break;
        case 'analytics':
          html = renderAnalytics();
          break;
      }

      document.getElementById('app').innerHTML = html;
    }

    // Auto-refresh
    setInterval(fetchData, refreshInterval);

    // Initial load
    fetchData();
  </script>
</body>
</html>
