<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Beacon - Neural Trading System</title>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #8b5cf6;
            --primary-light: #a78bfa;
            --primary-dark: #6d28d9;
            --accent: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0a0e1a;
            --bg-card: rgba(17, 24, 39, 0.7);
            --text: #f8fafc;
            --text-muted: #94a3b8;
            --border: rgba(139, 92, 246, 0.2);
        }

        /* Live Trading Mode (Weekday) */
        body.live-mode {
            --primary: #f59e0b;
            --primary-light: #fbbf24;
            --primary-dark: #d97706;
            --accent: #f97316;
            --border: rgba(245, 158, 11, 0.3);
        }

        body.live-mode .bg-animation {
            background: 
                radial-gradient(circle at 20% 50%, rgba(245, 158, 11, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(249, 115, 22, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(251, 191, 36, 0.15) 0%, transparent 50%);
        }

        body.live-mode .grid-overlay {
            background-image: 
                linear-gradient(rgba(245, 158, 11, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(245, 158, 11, 0.05) 1px, transparent 1px);
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
            animation: bgMove 20s ease infinite;
        }

        @keyframes bgMove {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        .grid-overlay {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            background-image: 
                linear-gradient(rgba(139, 92, 246, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(139, 92, 246, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), var(--accent), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.5); }
            50% { box-shadow: 0 0 40px rgba(236, 72, 153, 0.7); }
        }

        .header-title {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .header-title h1 {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-light), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-subtitle {
            font-size: 0.9em;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badges {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .status-badge.live::before {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            left: 12px;
            animation: pulse-dot 2s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
        }

        .mode-badge {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.2);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .stat-label {
            font-size: 0.85em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 3em;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9em;
            color: var(--success);
            font-weight: 500;
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Chart Section */
        .chart-section {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .section-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 700;
        }

        /* System Health */
        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .health-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
        }

        .health-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .health-icon-wrapper {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(236, 72, 153, 0.2));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .health-title {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .health-status {
            font-size: 0.85em;
            color: var(--text-muted);
        }

        /* Trading Pairs */
        .pairs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .pair-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 25px;
            transition: all 0.3s;
        }

        .pair-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(139, 92, 246, 0.2);
        }

        .pair-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .pair-name {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4em;
            font-weight: 700;
        }

        .pair-flag {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .signal-badge {
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .signal-buy {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .signal-sell {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .signal-hold {
            background: rgba(100, 116, 139, 0.15);
            color: var(--text-muted);
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        .pair-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .detail-label {
            font-size: 0.8em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .detail-value {
            font-size: 1.1em;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        /* Refresh Indicator */
        .refresh-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(17, 24, 39, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 12px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
            font-size: 0.9em;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .footer-link {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-link:hover {
            color: var(--primary-light);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .header-title h1 {
                font-size: 2em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    <div class="grid-overlay"></div>

    <div class="refresh-indicator">
        <div class="spinner"></div>
        <span>Auto-refresh: <strong id="countdown">60</strong>s</span>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-icon">
                        <i data-lucide="brain-circuit" stroke-width="2" size="32"></i>
                    </div>
                    <div class="header-title">
                        <h1>Trade Beacon</h1>
                        <div class="header-subtitle">
                            <i data-lucide="activity" size="16"></i>
                            <span>Neural Trading System v18.1</span>
                        </div>
                    </div>
                </div>
                <div class="status-badges">
                    <div class="status-badge live">
                        <i data-lucide="circle" size="16"></i>
                        <span>SYSTEM ACTIVE</span>
                    </div>
                    <div class="status-badge mode-badge" id="modeBadge">
                        <i data-lucide="sunset" size="16"></i>
                        <span>WEEKEND LEARNING</span>
                    </div>
                    <div class="status-badge" style="background: rgba(236, 72, 153, 0.1); border: 1px solid rgba(236, 72, 153, 0.3);">
                        <i data-lucide="clock" size="16"></i>
                        <span id="marketCountdown">Calculating...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Total Trades</span>
                    <div class="stat-icon">
                        <i data-lucide="trending-up" size="20"></i>
                    </div>
                </div>
                <div class="stat-value" id="totalTrades">-</div>
                <div class="stat-change">
                    <i data-lucide="arrow-up-right" size="16"></i>
                    <span id="tradesChange">+343 today</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Win Rate</span>
                    <div class="stat-icon">
                        <i data-lucide="target" size="20"></i>
                    </div>
                </div>
                <div class="stat-value" id="winRate">-</div>
                <div class="stat-change">
                    <i data-lucide="trophy" size="16"></i>
                    <span>Target: 45%+</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="winRateBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Total P&L</span>
                    <div class="stat-icon">
                        <i data-lucide="dollar-sign" size="20"></i>
                    </div>
                </div>
                <div class="stat-value" id="totalPnl">-</div>
                <div class="stat-change" id="pnlChange">
                    <i data-lucide="arrow-up-right" size="16"></i>
                    <span>+$36.46</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Experience Pool</span>
                    <div class="stat-icon">
                        <i data-lucide="database" size="20"></i>
                    </div>
                </div>
                <div class="stat-value" id="experience">-</div>
                <div class="stat-change">
                    <i data-lucide="hard-drive" size="16"></i>
                    <span>15,000 max capacity</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Epsilon</span>
                    <div class="stat-icon">
                        <i data-lucide="compass" size="20"></i>
                    </div>
                </div>
                <div class="stat-value" id="epsilon">-</div>
                <div class="stat-change">
                    <i data-lucide="search" size="16"></i>
                    <span>Exploration Rate</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="epsilonBar" style="width: 10%"></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Iteration</span>
                    <div class="stat-icon">
                        <i data-lucide="rotate-cw" size="20"></i>
                    </div>
                </div>
                <div class="stat-value" id="iteration">-</div>
                <div class="stat-change">
                    <i data-lucide="clock" size="16"></i>
                    <span id="lastUpdate">Loading...</span>
                </div>
            </div>
        </div>

        <!-- System Health -->
        <div class="chart-section">
            <div class="section-header">
                <div class="section-icon">
                    <i data-lucide="activity" size="24"></i>
                </div>
                <h2 class="section-title">System Health Monitor</h2>
            </div>
            <div class="health-grid">
                <div class="health-card">
                    <div class="health-icon-wrapper">
                        <i data-lucide="database" size="28" stroke-width="2"></i>
                    </div>
                    <div class="health-title">Data Pipeline</div>
                    <div class="health-status" id="pipelineHealth">Operational</div>
                </div>
                <div class="health-card">
                    <div class="health-icon-wrapper">
                        <i data-lucide="brain" size="28" stroke-width="2"></i>
                    </div>
                    <div class="health-title">RL Agent</div>
                    <div class="health-status" id="agentHealth">Training</div>
                </div>
                <div class="health-card">
                    <div class="health-icon-wrapper">
                        <i data-lucide="check-circle" size="28" stroke-width="2"></i>
                    </div>
                    <div class="health-title">Data Quality</div>
                    <div class="health-status" id="dataQuality">Excellent (Q:93)</div>
                </div>
                <div class="health-card">
                    <div class="health-icon-wrapper">
                        <i data-lucide="cloud" size="28" stroke-width="2"></i>
                    </div>
                    <div class="health-title">API Status</div>
                    <div class="health-status" id="apiStatus">4/25 calls (16%)</div>
                </div>
            </div>
        </div>

        <!-- Trading Pairs -->
        <div class="chart-section">
            <div class="section-header">
                <div class="section-icon">
                    <i data-lucide="candlestick-chart" size="24"></i>
                </div>
                <h2 class="section-title">Active Trading Pairs</h2>
            </div>
            <div class="pairs-grid" id="pairsGrid">
                <!-- Pairs will be loaded here -->
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p style="font-size: 1.1em; font-weight: 600; margin-bottom: 10px;">
                Trade Beacon Neural Trading System v18.1
            </p>
            <p style="margin-bottom: 15px; color: var(--text-muted);">
                Coded with <i data-lucide="heart" size="14" style="display: inline; vertical-align: middle; color: #ef4444;"></i> by 
                <strong style="color: var(--primary-light);">Rahim Dotai</strong>
            </p>
            <div class="footer-links">
                <a href="https://github.com/rahim-dotAI/forex-ai-models" target="_blank" class="footer-link">
                    <i data-lucide="github" size="16"></i>
                    <span>github.com/rahim-dotAI/forex-ai-models</span>
                </a>
                <a href="https://github.com/features/actions" target="_blank" class="footer-link">
                    <i data-lucide="zap" size="16"></i>
                    <span>Powered by GitHub Actions</span>
                </a>
            </div>
            <p style="margin-top: 15px; font-size: 0.85em; opacity: 0.6;">
                Â© 2025 Trade Beacon. Real-time autonomous trading powered by Deep Q-Learning.
            </p>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Configuration
        const GITHUB_USERNAME = 'rahim-dotAI';
        const GITHUB_REPO = 'forex-ai-models';
        const REFRESH_INTERVAL = 60000;

        // Market hours (Monday 00:00 UTC to Friday 23:59 UTC)
        function getNextMarketOpen() {
            const now = new Date();
            const day = now.getUTCDay();
            const hours = now.getUTCHours();
            const minutes = now.getUTCMinutes();
            
            // If it's weekend (0 = Sunday, 6 = Saturday)
            if (day === 0) {
                // Sunday - market opens Monday 00:00 UTC
                const nextMonday = new Date(now);
                nextMonday.setUTCDate(now.getUTCDate() + 1);
                nextMonday.setUTCHours(0, 0, 0, 0);
                return nextMonday;
            } else if (day === 6) {
                // Saturday - market opens Monday 00:00 UTC
                const nextMonday = new Date(now);
                nextMonday.setUTCDate(now.getUTCDate() + 2);
                nextMonday.setUTCHours(0, 0, 0, 0);
                return nextMonday;
            }
            
            // Weekday - market is open
            return null;
        }

        function updateMarketCountdown() {
            const nextOpen = getNextMarketOpen();
            const countdownEl = document.getElementById('marketCountdown');
            
            if (!nextOpen) {
                countdownEl.textContent = 'Market Open';
                return;
            }
            
            const now = new Date();
            const diff = nextOpen - now;
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            countdownEl.textContent = `Market opens in ${hours}h ${minutes}m ${seconds}s`;
        }

        function updateModeDisplay() {
            const now = new Date();
            const day = now.getUTCDay();
            const isWeekend = day === 0 || day === 6;
            
            const modeBadge = document.getElementById('modeBadge');
            const body = document.body;
            
            if (isWeekend) {
                // Weekend Learning Mode - Purple theme
                body.classList.remove('live-mode');
                modeBadge.innerHTML = '<i data-lucide="moon" size="16"></i><span>WEEKEND LEARNING</span>';
                modeBadge.style.background = 'rgba(139, 92, 246, 0.1)';
                modeBadge.style.border = '1px solid rgba(139, 92, 246, 0.3)';
            } else {
                // Live Trading Mode - Golden Sun theme
                body.classList.add('live-mode');
                modeBadge.innerHTML = '<i data-lucide="sun" size="16"></i><span>LIVE TRADING</span>';
                modeBadge.style.background = 'rgba(245, 158, 11, 0.1)';
                modeBadge.style.border = '1px solid rgba(245, 158, 11, 0.3)';
            }
            
            lucide.createIcons();
        }

        // Update countdown every second
        setInterval(updateMarketCountdown, 1000);
        updateMarketCountdown();

        // Update mode display
        updateModeDisplay();
        setInterval(updateModeDisplay, 60000); // Check every minute

        // Auto-refresh countdown
        let countdown = 60;
        setInterval(() => {
            countdown--;
            if (countdown <= 0) {
                countdown = 60;
                loadAllData();
            }
            document.getElementById('countdown').textContent = countdown;
        }, 1000);

        // Load data from GitHub
        async function loadAllData() {
            try {
                const [statsResponse, signalsResponse, iterResponse] = await Promise.all([
                    fetch(`https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/main/rl_memory/learning_stats.json`),
                    fetch(`https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/main/outputs/omega_signals.json`),
                    fetch(`https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/main/omega_state/omega_iteration.json`)
                ]);

                if (!statsResponse.ok || !signalsResponse.ok || !iterResponse.ok) {
                    throw new Error('Failed to fetch data from GitHub');
                }

                const stats = await statsResponse.json();
                const signals = await signalsResponse.json();
                const iteration = await iterResponse.json();

                updateDashboard(stats, signals, iteration);
            } catch (error) {
                console.error('Error loading data:', error);
                // Set default values on error
                document.getElementById('totalTrades').textContent = '0';
                document.getElementById('winRate').textContent = '0%';
                document.getElementById('totalPnl').textContent = '$0.00';
                document.getElementById('epsilon').textContent = '0.100';
                document.getElementById('iteration').textContent = '#0';
                document.getElementById('experience').textContent = '0';
            }
        }

        function updateDashboard(stats, signals, iteration) {
            // Update stats
            document.getElementById('totalTrades').textContent = stats.total_trades?.toLocaleString() || '0';
            
            const winRate = (stats.win_rate || 0) * 100;
            document.getElementById('winRate').textContent = winRate.toFixed(1) + '%';
            document.getElementById('winRateBar').style.width = Math.min(winRate, 100) + '%';
            
            document.getElementById('totalPnl').textContent = '$' + (stats.total_pnl || 0).toFixed(2);
            
            const epsilon = stats.epsilon_history?.[stats.epsilon_history.length - 1] || 0.1;
            document.getElementById('epsilon').textContent = epsilon.toFixed(3);
            document.getElementById('epsilonBar').style.width = (epsilon * 100) + '%';
            
            document.getElementById('iteration').textContent = '#' + (iteration.total || '0');
            
            const experience = Math.min(stats.total_trades * 1.6, 15000);
            document.getElementById('experience').textContent = Math.floor(experience).toLocaleString();

            // Update mode
            const now = new Date();
            const isWeekend = now.getDay() === 0 || now.getDay() === 6;
            const modeBadge = document.getElementById('modeBadge');
            
            if (isWeekend) {
                modeBadge.innerHTML = '<i data-lucide="sun" size="16"></i><span>WEEKEND LEARNING</span>';
            } else {
                modeBadge.innerHTML = '<i data-lucide="zap" size="16"></i><span>LIVE TRADING</span>';
            }

            // Update health
            document.getElementById('agentHealth').textContent = isWeekend ? 'Learning Mode' : 'Live Trading';
            document.getElementById('pipelineHealth').textContent = 'Operational';
            
            // Update timestamp
            const timestamp = new Date(signals.timestamp);
            document.getElementById('lastUpdate').textContent = timestamp.toLocaleTimeString();

            // Update mode and countdown
            updateModeDisplay();
            updateMarketCountdown();

            // Update trading pairs
            updatePairs(signals.signals);

            // Reinitialize icons
            lucide.createIcons();
        }

        function updatePairs(pairSignals) {
            const pairsGrid = document.getElementById('pairsGrid');
            pairsGrid.innerHTML = '';

            const pairs = ['EUR/USD', 'GBP/USD', 'USD/JPY', 'AUD/USD'];
            const icons = {
                'EUR/USD': 'euro',
                'GBP/USD': 'pound-sterling',
                'USD/JPY': 'yen',
                'AUD/USD': 'dollar-sign'
            };

            pairs.forEach(pair => {
                const pairData = pairSignals?.[pair] || {};
                const signals = pairData.signals || {};
                const timeframes = Object.keys(signals);
                const primarySignal = signals['1h'] || signals[timeframes[0]] || {};
                const direction = pairData.aggregated || 'HOLD';
                
                const directionIcons = {
                    'BUY': 'trending-up',
                    'SELL': 'trending-down',
                    'HOLD': 'minus'
                };
                
                const card = document.createElement('div');
                card.className = 'pair-card';
                card.innerHTML = `
                    <div class="pair-header">
                        <div class="pair-name">
                            <div class="pair-flag">
                                <i data-lucide="${icons[pair]}" size="20"></i>
                            </div>
                            <span>${pair}</span>
                        </div>
                        <div class="signal-badge signal-${direction.toLowerCase()}">
                            <i data-lucide="${directionIcons[direction]}" size="16"></i>
                            <span>${direction}</span>
                        </div>
                    </div>
                    <div class="pair-details">
                        <div class="detail-item">
                            <span class="detail-label">
                                <i data-lucide="bar-chart-3" size="14"></i>
                                Price
                            </span>
                            <span class="detail-value">${(primarySignal.live || 0).toFixed(5)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">
                                <i data-lucide="gauge" size="14"></i>
                                Confidence
                            </span>
                            <span class="detail-value">${(primarySignal.confidence || 0).toFixed(1)}%</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">
                                <i data-lucide="shield-alert" size="14"></i>
                                Stop Loss
                            </span>
                            <span class="detail-value">${(primarySignal.SL || 0).toFixed(5)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">
                                <i data-lucide="target" size="14"></i>
                                Take Profit
                            </span>
                            <span class="detail-value">${(primarySignal.TP || 0).toFixed(5)}</span>
                        </div>
                    </div>
                `;
                pairsGrid.appendChild(card);
            });

            // Reinitialize icons after adding new content
            lucide.createIcons();
        }

        // Initial load
        setTimeout(() => {
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
            loadAllData();
        }, 100);

        // Auto-refresh
        setInterval(loadAllData, REFRESH_INTERVAL);
    </script>
</body>
</html>
