<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade Beacon | Live Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#0a0e1a;--surface:#111827;--surface-light:#1f2937;
--border:#374151;--text:#f9fafb;--text-dim:#9ca3af;
--primary:#3b82f6;--success:#10b981;
--danger:#ef4444;--warning:#f59e0b;
--purple:#a855f7;--cyan:#06b6d4;
}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden}

/* NAVBAR */
.navbar{
display:flex;justify-content:space-between;align-items:center;
padding:20px 32px;background:var(--surface);
border-bottom:1px solid var(--border);
backdrop-filter:blur(20px);position:sticky;top:0;z-index:100;
}
.logo{font-size:28px;font-weight:900;letter-spacing:-1px;display:flex;align-items:center;gap:12px}
.logo span{
background:linear-gradient(135deg,var(--primary),var(--purple));
-webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.logo-icon{
width:40px;height:40px;
background:linear-gradient(135deg,var(--primary),var(--purple));
border-radius:12px;display:flex;align-items:center;justify-content:center;
font-size:20px;
animation:float 3s ease-in-out infinite;
}
@keyframes float{
0%,100%{transform:translateY(0px)}
50%{transform:translateY(-10px)}
}

.status-pill{
padding:8px 16px;border-radius:24px;font-size:13px;font-weight:700;
display:flex;align-items:center;gap:8px;
}
.status-live{background:rgba(16,185,129,.2);color:var(--success);border:2px solid var(--success)}
.status-stale{background:rgba(245,158,11,.2);color:var(--warning);border:2px solid var(--warning)}
.status-offline{background:rgba(239,68,68,.2);color:var(--danger);border:2px solid var(--danger)}
.pulse{
width:8px;height:8px;border-radius:50%;background:currentColor;
animation:pulse 2s infinite;
}
@keyframes pulse{50%{opacity:.3;transform:scale(1.2)}}

.container{max-width:1600px;margin:auto;padding:32px}
.grid{display:grid;gap:24px}
.grid-4{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
.grid-2{grid-template-columns:2fr 1fr}
@media(max-width:1200px){.grid-2{grid-template-columns:1fr}}

.card,.metric-card{
background:var(--surface);
border:1px solid var(--border);
border-radius:20px;padding:28px;
transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
}
.card:hover,.metric-card:hover{
transform:translateY(-4px);
border-color:var(--primary);
box-shadow:0 20px 60px rgba(59,130,246,0.15);
}

.metric-label{
font-size:12px;color:var(--text-dim);text-transform:uppercase;
letter-spacing:1px;font-weight:600;margin-bottom:12px;
}
.metric-value{font-size:42px;font-weight:900;letter-spacing:-2px}

/* MODE SWITCHER - PREMIUM DESIGN */
.mode-switcher{
background:linear-gradient(135deg,rgba(59,130,246,0.1),rgba(168,85,247,0.1));
border:2px solid var(--border);
border-radius:24px;
padding:32px;
margin-bottom:32px;
position:relative;
overflow:hidden;
}
.mode-switcher::before{
content:'';
position:absolute;
top:-50%;right:-50%;
width:200%;height:200%;
background:conic-gradient(from 0deg,transparent,rgba(59,130,246,0.1),transparent);
animation:rotate 8s linear infinite;
}
@keyframes rotate{to{transform:rotate(360deg)}}

.mode-switcher > *{position:relative;z-index:1}

.mode-header{
display:flex;align-items:center;gap:12px;margin-bottom:24px;
}
.mode-header h3{
font-size:24px;font-weight:800;
background:linear-gradient(135deg,var(--primary),var(--purple));
-webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.mode-icon{
font-size:32px;
animation:spin3d 4s ease-in-out infinite;
}
@keyframes spin3d{
0%,100%{transform:rotateY(0deg) rotateX(0deg)}
25%{transform:rotateY(180deg) rotateX(0deg)}
50%{transform:rotateY(180deg) rotateX(180deg)}
75%{transform:rotateY(0deg) rotateX(180deg)}
}

.mode-toggle{
display:grid;
grid-template-columns:1fr 1fr;
gap:20px;
margin-bottom:20px;
}
.mode-btn{
padding:24px;
border:3px solid var(--border);
border-radius:20px;
background:var(--surface-light);
color:var(--text);
cursor:pointer;
transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
text-align:center;
position:relative;
overflow:hidden;
}
.mode-btn::before{
content:'';
position:absolute;
top:50%;left:50%;
width:0;height:0;
border-radius:50%;
background:radial-gradient(circle,rgba(59,130,246,0.3),transparent);
transform:translate(-50%,-50%);
transition:width 0.6s,height 0.6s;
}
.mode-btn:hover::before{width:400px;height:400px}
.mode-btn:hover{
transform:translateY(-8px) scale(1.02);
border-color:var(--primary);
box-shadow:0 20px 60px rgba(59,130,246,0.3);
}
.mode-btn.active{
background:linear-gradient(135deg,var(--primary),var(--purple));
border-color:transparent;
transform:translateY(-4px) scale(1.05);
box-shadow:0 20px 60px rgba(59,130,246,0.4);
}
.mode-btn.active .mode-icon-3d{
animation:bounce 1s ease-in-out;
}
@keyframes bounce{
0%,100%{transform:scale(1) rotateZ(0deg)}
50%{transform:scale(1.2) rotateZ(360deg)}
}

.mode-icon-3d{
font-size:48px;margin-bottom:12px;
display:inline-block;
transition:transform 0.3s;
filter:drop-shadow(0 10px 20px rgba(0,0,0,0.3));
}
.mode-btn:hover .mode-icon-3d{
transform:scale(1.1) rotateY(20deg) rotateX(10deg);
}

.mode-btn .mode-title{
font-size:20px;font-weight:800;margin-bottom:8px;
}
.mode-btn .mode-desc{
font-size:13px;opacity:0.9;font-weight:400;line-height:1.4;
}
.mode-badge{
display:inline-block;
padding:6px 14px;
border-radius:16px;
font-size:10px;
font-weight:800;
margin-top:12px;
text-transform:uppercase;
letter-spacing:1px;
}
.mode-badge.conservative{
background:rgba(16,185,129,.25);
color:var(--success);
}
.mode-badge.aggressive{
background:rgba(239,68,68,.25);
color:var(--danger);
}

.mode-info{
padding:20px;
background:var(--surface-light);
border-radius:16px;
font-size:14px;
line-height:1.8;
border-left:4px solid var(--primary);
}
.mode-info strong{color:var(--primary);font-weight:700}

/* CONFIG MODAL */
.modal-overlay{
position:fixed;inset:0;
background:rgba(0,0,0,0.8);
backdrop-filter:blur(10px);
display:flex;align-items:center;justify-content:center;
z-index:10000;
animation:fadeIn 0.3s;
}
@keyframes fadeIn{from{opacity:0}}
.modal{
background:var(--surface);
border:2px solid var(--border);
border-radius:24px;
padding:40px;
max-width:600px;
width:90%;
max-height:80vh;
overflow-y:auto;
animation:slideUp 0.4s cubic-bezier(0.4,0,0.2,1);
}
@keyframes slideUp{from{transform:translateY(50px);opacity:0}}
.modal h2{
font-size:28px;
margin-bottom:24px;
background:linear-gradient(135deg,var(--primary),var(--purple));
-webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.input-group{
margin-bottom:24px;
}
.input-group label{
display:block;
font-size:14px;
font-weight:600;
color:var(--text-dim);
margin-bottom:8px;
text-transform:uppercase;
letter-spacing:1px;
}
.input-group input{
width:100%;
padding:14px 18px;
background:var(--surface-light);
border:2px solid var(--border);
border-radius:12px;
color:var(--text);
font-size:16px;
font-family:inherit;
transition:all 0.3s;
}
.input-group input:focus{
outline:none;
border-color:var(--primary);
box-shadow:0 0 0 3px rgba(59,130,246,0.1);
}
.input-group input::placeholder{
color:var(--text-dim);
opacity:0.5;
}
.btn-group{
display:flex;
gap:12px;
margin-top:32px;
}
.btn{
flex:1;
padding:14px 24px;
border:none;
border-radius:12px;
font-size:16px;
font-weight:700;
cursor:pointer;
transition:all 0.3s;
}
.btn-primary{
background:linear-gradient(135deg,var(--primary),var(--purple));
color:white;
}
.btn-primary:hover{
transform:translateY(-2px);
box-shadow:0 10px 30px rgba(59,130,246,0.4);
}
.btn-secondary{
background:var(--surface-light);
color:var(--text);
border:2px solid var(--border);
}
.btn-secondary:hover{
border-color:var(--primary);
}

.config-notice{
background:rgba(245,158,11,0.1);
border:2px solid var(--warning);
border-radius:12px;
padding:16px;
margin-bottom:24px;
font-size:14px;
line-height:1.6;
}

/* SIGNAL CARDS */
.signal-card{
background:var(--surface-light);
border-radius:16px;
padding:20px;margin-bottom:16px;
border-left:5px solid;
transition:all 0.3s;
position:relative;
overflow:hidden;
}
.signal-card::before{
content:'';
position:absolute;
top:0;right:0;
width:100px;height:100px;
background:radial-gradient(circle,rgba(255,255,255,0.05),transparent);
transition:all 0.3s;
}
.signal-card:hover{
transform:translateX(8px);
box-shadow:0 10px 30px rgba(0,0,0,0.3);
}
.signal-card:hover::before{
width:200px;height:200px;
}
.signal-card.buy{border-color:var(--success)}
.signal-card.sell{border-color:var(--danger)}

.signal-pair{font-size:20px;font-weight:800;margin-bottom:8px}
.signal-direction{
display:inline-block;
padding:4px 12px;
border-radius:12px;
font-size:12px;
font-weight:700;
margin-left:8px;
}
.signal-direction.buy{background:rgba(16,185,129,.2);color:var(--success)}
.signal-direction.sell{background:rgba(239,68,68,.2);color:var(--danger)}

.loading-overlay{
position:fixed;inset:0;
background:linear-gradient(135deg,rgba(10,14,26,0.98),rgba(17,24,39,0.98));
display:flex;align-items:center;justify-content:center;
z-index:9999;backdrop-filter:blur(20px);
}
.loading-content{text-align:center}
.loading-spinner{
width:64px;height:64px;
border:6px solid var(--border);
border-top-color:var(--primary);
border-bottom-color:var(--purple);
border-radius:50%;
animation:spin 1s linear infinite;
margin:0 auto 20px;
filter:drop-shadow(0 0 20px rgba(59,130,246,0.5));
}
@keyframes spin{to{transform:rotate(360deg)}}

.settings-row{
display:flex;
justify-content:space-between;
padding:16px 0;
border-bottom:1px solid var(--border);
align-items:center;
}
.settings-row:last-child{border:none}
.settings-label{color:var(--text-dim);font-size:14px;font-weight:500}
.settings-value{
font-weight:700;
padding:6px 14px;
background:var(--surface-light);
border-radius:12px;
font-size:13px;
}

.notification{
position:fixed;
top:90px;right:32px;
background:var(--surface);
border:2px solid var(--primary);
border-radius:16px;
padding:20px 28px;
z-index:10000;
animation:slideIn 0.4s cubic-bezier(0.4,0,0.2,1);
box-shadow:0 20px 60px rgba(59,130,246,0.3);
max-width:400px;
}
@keyframes slideIn{from{transform:translateX(500px);opacity:0}}
@keyframes slideOut{to{transform:translateX(500px);opacity:0}}

h3{margin-bottom:20px;font-size:20px;font-weight:800}

.config-btn{
padding:8px 16px;
background:var(--surface-light);
border:2px solid var(--border);
border-radius:12px;
color:var(--text);
font-size:13px;
font-weight:600;
cursor:pointer;
transition:all 0.3s;
}
.config-btn:hover{
border-color:var(--primary);
transform:translateY(-2px);
}
</style>
</head>

<body>

<div class="loading-overlay" id="loading">
<div class="loading-content">
<div class="loading-spinner"></div>
<p style="font-size:18px;font-weight:600;color:var(--text)">Initializing Trade Beacon</p>
<p style="margin-top:8px;font-size:14px;color:var(--text-dim)">Loading market data...</p>
</div>
</div>

<!-- CONFIG MODAL -->
<div class="modal-overlay" id="configModal" style="display:none">
<div class="modal">
<h2>üîê GitHub Configuration</h2>
<div class="config-notice">
‚ö†Ô∏è <strong>Security Notice:</strong> Your credentials are stored locally in your browser and never transmitted to any server except GitHub's official API.
</div>
<div class="input-group">
<label>GitHub Username</label>
<input type="text" id="githubUsername" placeholder="your-username">
</div>
<div class="input-group">
<label>Repository Name</label>
<input type="text" id="githubRepo" placeholder="forex-ai-models">
</div>
<div class="input-group">
<label>GitHub Personal Access Token</label>
<input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
<p style="font-size:12px;color:var(--text-dim);margin-top:8px">
Create at: <a href="https://github.com/settings/tokens" target="_blank" style="color:var(--primary)">github.com/settings/tokens</a><br>
Required permission: <code style="background:var(--surface-light);padding:2px 6px;border-radius:4px">repo</code>
</p>
</div>
<div class="btn-group">
<button class="btn btn-secondary" onclick="closeConfigModal()">Cancel</button>
<button class="btn btn-primary" onclick="saveConfig()">Save Configuration</button>
</div>
</div>
</div>

<nav class="navbar">
<div class="logo">
<div class="logo-icon">üì°</div>
<div>Trade<span>Beacon</span></div>
</div>
<div style="display:flex;align-items:center;gap:16px">
<button class="config-btn" onclick="openConfigModal()">‚öôÔ∏è Configure GitHub</button>
<div class="status-pill status-live" id="health">
<span class="pulse"></span>
<span id="healthText">LIVE</span>
</div>
</div>
</nav>

<div class="container">

<!-- MODE SWITCHER -->
<div class="mode-switcher">
<div class="mode-header">
<div class="mode-icon">üéØ</div>
<h3>Trading Strategy Mode</h3>
</div>
<div class="mode-toggle">
<button class="mode-btn" id="btnConservative" onclick="setMode('conservative')">
<div class="mode-icon-3d">üõ°Ô∏è</div>
<div class="mode-title">High Confidence</div>
<div class="mode-desc">Premium quality signals with strict filtering</div>
<span class="mode-badge conservative">Quality First</span>
</button>
<button class="mode-btn active" id="btnAggressive" onclick="setMode('aggressive')">
<div class="mode-icon-3d">‚ö°</div>
<div class="mode-title">Aggressive</div>
<div class="mode-desc">Maximum opportunities with flexible criteria</div>
<span class="mode-badge aggressive">Volume First</span>
</button>
</div>
<div class="mode-info" id="modeInfo">
<strong>Active Configuration:</strong> Aggressive Mode ‚Ä¢ Threshold: 30 ‚Ä¢ Min ADX: None ‚Ä¢ RSI: Any
</div>
</div>

<!-- METRICS -->
<div class="grid grid-4">
<div class="metric-card">
<div class="metric-label">‚ö° Active Signals</div>
<div class="metric-value" style="color:var(--primary)" id="activeSignals">0</div>
</div>
<div class="metric-card">
<div class="metric-label">üìä Win Rate</div>
<div class="metric-value" style="color:var(--success)" id="winRate">0%</div>
</div>
<div class="metric-card">
<div class="metric-label">üí∞ Total Pips</div>
<div class="metric-value" style="color:var(--warning)" id="totalPips">0</div>
</div>
<div class="metric-card">
<div class="metric-label">üìà Today</div>
<div class="metric-value" style="color:var(--cyan)" id="dailyPips">0</div>
</div>
</div>

<div class="grid grid-2" style="margin-top:32px">

<div class="card">
<h3>üéØ Active Trading Signals</h3>
<div id="signals"></div>
</div>

<div class="card">
<h3>‚öôÔ∏è System Configuration</h3>
<div class="settings-row">
<span class="settings-label">Last Update</span>
<span class="settings-value" id="lastUpdate">-</span>
</div>
<div class="settings-row">
<span class="settings-label">API Calls</span>
<span class="settings-value" id="apiCalls">-</span>
</div>
<div class="settings-row">
<span class="settings-label">Signal Threshold</span>
<span class="settings-value" id="currentThreshold">30</span>
</div>
<div class="settings-row">
<span class="settings-label">Minimum ADX</span>
<span class="settings-value" id="currentADX">None</span>
</div>
<div class="settings-row">
<span class="settings-label">RSI Filter</span>
<span class="settings-value" id="currentRSI">Any</span>
</div>
</div>

</div>
</div>

<script>
const API_URL = 'https://raw.githubusercontent.com/rahim-dotai/forex-ai-models/main/signal_state/dashboard_state.json';

const MODES = {
  conservative: {
    name: 'High Confidence',
    icon: 'üõ°Ô∏è',
    threshold: 50,
    minADX: 20,
    rsiOversold: 35,
    rsiOverbought: 65,
    description: 'High Confidence Mode ‚Ä¢ Threshold: 50 ‚Ä¢ Min ADX: 20 ‚Ä¢ RSI: <35 or >65'
  },
  aggressive: {
    name: 'Aggressive',
    icon: '‚ö°',
    threshold: 30,
    minADX: null,
    rsiOversold: 40,
    rsiOverbought: 60,
    description: 'Aggressive Mode ‚Ä¢ Threshold: 30 ‚Ä¢ Min ADX: None ‚Ä¢ RSI: Any'
  }
};

let currentMode = 'aggressive';
let lastSuccess = null;
let githubConfig = null;

// Load saved config
function loadGithubConfig() {
  const saved = localStorage.getItem('tradeBeaconGithubConfig');
  if (saved) {
    try {
      githubConfig = JSON.parse(saved);
      return true;
    } catch (e) {
      return false;
    }
  }
  return false;
}

function openConfigModal() {
  document.getElementById('configModal').style.display = 'flex';
  if (githubConfig) {
    document.getElementById('githubUsername').value = githubConfig.username || '';
    document.getElementById('githubRepo').value = githubConfig.repo || '';
    document.getElementById('githubToken').value = githubConfig.token || '';
  }
}

function closeConfigModal() {
  document.getElementById('configModal').style.display = 'none';
}

function saveConfig() {
  const username = document.getElementById('githubUsername').value.trim();
  const repo = document.getElementById('githubRepo').value.trim();
  const token = document.getElementById('githubToken').value.trim();
  
  if (!username || !repo || !token) {
    showNotification('‚ùå Please fill in all fields', 'error');
    return;
  }
  
  githubConfig = { username, repo, token };
  localStorage.setItem('tradeBeaconGithubConfig', JSON.stringify(githubConfig));
  
  closeConfigModal();
  showNotification('‚úÖ GitHub configuration saved securely', 'success');
}

async function triggerGithubWorkflow(mode) {
  if (!githubConfig) {
    showNotification('‚ö†Ô∏è Please configure GitHub credentials first', 'warning');
    setTimeout(() => openConfigModal(), 1500);
    return false;
  }
  
  try {
    const url = `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/dispatches`;
    
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Accept': 'application/vnd.github+json',
        'Authorization': `Bearer ${githubConfig.token}`,
        'Content-Type': 'application/json',
        'X-GitHub-Api-Version': '2022-11-28'
      },
      body: JSON.stringify({
        event_type: 'update-mode',
        client_payload: {
          mode: mode
        }
      })
    });
    
    if (response.status === 204) {
      return true;
    } else {
      const error = await response.text();
      console.error('GitHub API Error:', error);
      return false;
    }
  } catch (error) {
    console.error('Network error:', error);
    return false;
  }
}

function setMode(mode) {
  currentMode = mode;
  
  document.getElementById('btnConservative').classList.toggle('active', mode === 'conservative');
  document.getElementById('btnAggressive').classList.toggle('active', mode === 'aggressive');
  
  const config = MODES[mode];
  document.getElementById('modeInfo').innerHTML = `<strong>Active Configuration:</strong> ${config.description}`;
  document.getElementById('currentThreshold').textContent = config.threshold;
  document.getElementById('currentADX').textContent = config.minADX || 'None';
  document.getElementById('currentRSI').textContent = 
    config.minADX ? `<${config.rsiOversold} or >${config.rsiOverbought}` : 'Any';
  
  localStorage.setItem('tradeBeaconMode', mode);
  
  // Trigger GitHub workflow
  if (loadGithubConfig()) {
    showNotification(`${config.icon} Switching to ${config.name} mode...`, 'info');
    
    triggerGithubWorkflow(mode).then(success => {
      if (success) {
        showNotification(`‚úÖ ${config.name} mode activated - Next run will use new settings`, 'success');
      } else {
        showNotification('‚ùå Failed to trigger GitHub workflow - Check your token permissions', 'error');
      }
    });
  } else {
    showNotification(`${config.icon} Mode changed (UI only) - Configure GitHub to sync with bot`, 'warning');
  }
}

function showNotification(msg, type = 'info') {
  const notification = document.createElement('div');
  notification.className = 'notification';
  
  // Add color based on type
  if (type === 'error') {
    notification.style.borderColor = 'var(--danger)';
  } else if (type === 'success') {
    notification.style.borderColor = 'var(--success)';
  } else if (type === 'warning') {
    notification.style.borderColor = 'var(--warning)';
  }
  
  notification.textContent = msg;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.4s cubic-bezier(0.4,0,0.2,1)';
    setTimeout(() => notification.remove(), 400);
  }, 3500);
}

function parseTime(iso){
  if(!iso) return '-';
  return new Date(iso.replace('+00:00','Z')).toLocaleString();
}

function setHealth(state){
  const el=document.getElementById('health');
  const txt=document.getElementById('healthText');
  el.className='status-pill status-'+state;
  txt.textContent=state.toUpperCase();
}

async function fetchState(){
  const r=await fetch(API_URL+'?t='+Date.now(),{cache:'no-store'});
  if(!r.ok) throw new Error(r.status);
  return r.json();
}

function render(d){
  document.getElementById('loading').style.display='none';
  lastSuccess=Date.now();
  setHealth('live');

  document.getElementById('activeSignals').textContent=d.active_signals || 0;
  document.getElementById('winRate').textContent=(d.stats?.win_rate || 0).toFixed(1)+'%';
  document.getElementById('totalPips').textContent=(d.stats?.total_pips || 0).toFixed(1);
  document.getElementById('dailyPips').textContent=(d.risk_management?.daily_pips || 0).toFixed(1);

  document.getElementById('lastUpdate').textContent=parseTime(d.timestamp);
  document.getElementById('apiCalls').textContent=d.api_usage?.yfinance?.calls || 0;

  const signals = d.signals || [];
  const html=signals.map(s=>{
    const dir = s.direction.toLowerCase();
    return `
    <div class="signal-card ${dir}">
      <div class="signal-pair">
        ${s.pair}
        <span class="signal-direction ${dir}">${s.direction}</span>
        ${s.confidence ? `<span style="font-size:14px;opacity:0.7;margin-left:8px">${s.confidence}</span>` : ''}
      </div>
      <div style="font-size:14px;color:var(--text-dim);margin-top:8px">
        ${s.entry_price ? `Entry: <strong style="color:var(--text)">${s.entry_price.toFixed(5)}</strong>` : ''}
        ${s.sl ? ` ‚Ä¢ SL: <strong>${s.sl.toFixed(5)}</strong>` : ''}
        ${s.tp ? ` ‚Ä¢ TP: <strong>${s.tp.toFixed(5)}</strong>` : ''}
        ${s.score ? `<br>Score: <strong style="color:var(--primary)">${s.score}</strong>` : ''}
        ${s.rsi ? ` ‚Ä¢ RSI: ${s.rsi.toFixed(1)}` : ''}
        ${s.adx ? ` ‚Ä¢ ADX: ${s.adx.toFixed(1)}` : ''}
      </div>
      ${s.timestamp ? `<div style="font-size:12px;color:var(--text-dim);margin-top:8px">‚è∞ ${parseTime(s.timestamp)}</div>` : ''}
    </div>
    `;
  }).join('');

  document.getElementById('signals').innerHTML = html || '<div style="text-align:center;color:var(--text-dim);padding:40px">No active signals</div>';
}

async function update(){
  try {
    const data = await fetchState();
    render(data);
  } catch (err) {
    console.error('Fetch error:', err);
    if (lastSuccess && Date.now() - lastSuccess < 300000) {
      setHealth('stale');
    } else {
      setHealth('offline');
      document.getElementById('loading').style.display = 'none';
    }
  }
}

// Initialize
loadGithubConfig();
const savedMode = localStorage.getItem('tradeBeaconMode');
if (savedMode && MODES[savedMode]) {
  currentMode = savedMode;
  document.getElementById('btnConservative').classList.toggle('active', savedMode === 'conservative');
  document.getElementById('btnAggressive').classList.toggle('active', savedMode === 'aggressive');
  const config = MODES[savedMode];
  document.getElementById('modeInfo').innerHTML = `<strong>Active Configuration:</strong> ${config.description}`;
  document.getElementById('currentThreshold').textContent = config.threshold;
  document.getElementById('currentADX').textContent = config.minADX || 'None';
  document.getElementById('currentRSI').textContent = 
    config.minADX ? `<${config.rsiOversold} or >${config.rsiOverbought}` : 'Any';
}

update();
setInterval(update, 30000);

// Close modal on outside click
document.getElementById('configModal').addEventListener('click', (e) => {
  if (e.target.id === 'configModal') {
    closeConfigModal();
  }
});
</script>

</body>
</html>
